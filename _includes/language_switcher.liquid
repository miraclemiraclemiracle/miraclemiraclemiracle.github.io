<!-- è¯­è¨€åˆ‡æ¢å™¨ -->
<div class="language-switcher">
  {% assign current_lang = site.lang | default: 'zh' %}
  
  <div class="dropdown">
    <button class="btn btn-sm dropdown-toggle" type="button" id="languageDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      {% if current_lang == 'zh' %}
        ğŸ‡¨ğŸ‡³ ä¸­æ–‡
      {% else %}
        ğŸ‡ºğŸ‡¸ English
      {% endif %}
    </button>
    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="languageDropdown">
      <a class="dropdown-item {% if current_lang == 'zh' %}active{% endif %}" href="#" onclick="switchLanguage('zh')">
        ğŸ‡¨ğŸ‡³ ä¸­æ–‡
      </a>
      <a class="dropdown-item {% if current_lang == 'en' %}active{% endif %}" href="#" onclick="switchLanguage('en')">
        ğŸ‡ºğŸ‡¸ English
      </a>
    </div>
  </div>
</div>

<script>
function switchLanguage(lang) {
  // ä¿å­˜è¯­è¨€é€‰æ‹©åˆ°localStorage
  localStorage.setItem('preferred_language', lang);
  
  // æ ¹æ®è¯­è¨€åˆ‡æ¢é¡µé¢å†…å®¹
  if (lang === 'en') {
    // åˆ‡æ¢åˆ°è‹±æ–‡ç‰ˆæœ¬
    switchToEnglish();
  } else {
    // åˆ‡æ¢åˆ°ä¸­æ–‡ç‰ˆæœ¬
    switchToChinese();
  }
}

function switchToChinese() {
  // æ›´æ–°é¡µé¢æ ‡é¢˜å’Œå¯¼èˆª
  document.title = 'åˆ˜è‰ºè½©çš„å­¦æœ¯ä¸»é¡µ';
  
  // æ›´æ–°å¯¼èˆªæ 
  const navItems = {
    'about': 'å…³äºæˆ‘',
    'publications': 'ç ”ç©¶ä¸å‘è¡¨',
    'cv': 'ç®€å†',
    'blog': 'åšå®¢'
  };
  
  // æ›´æ–°å¯¼èˆªé“¾æ¥æ–‡æœ¬
  document.querySelectorAll('.nav-link').forEach(link => {
    const href = link.getAttribute('href');
    if (href === '/') {
      link.textContent = 'å…³äºæˆ‘';
    } else if (href.includes('/publications/')) {
      link.textContent = 'ç ”ç©¶ä¸å‘è¡¨';
    } else if (href.includes('/cv/')) {
      link.textContent = 'ç®€å†';
    } else if (href.includes('/blog/')) {
      link.textContent = 'åšå®¢';
    }
  });
  
  // æ›´æ–°é¡µé¢å†…å®¹
  updatePageContent('zh');
}

function switchToEnglish() {
  // æ›´æ–°é¡µé¢æ ‡é¢˜å’Œå¯¼èˆª
  document.title = 'Yixuan Liu\'s Academic Homepage';
  
  // æ›´æ–°å¯¼èˆªé“¾æ¥æ–‡æœ¬
  document.querySelectorAll('.nav-link').forEach(link => {
    const href = link.getAttribute('href');
    if (href === '/') {
      link.textContent = 'About';
    } else if (href.includes('/publications/')) {
      link.textContent = 'Research & Publications';
    } else if (href.includes('/cv/')) {
      link.textContent = 'CV';
    } else if (href.includes('/blog/')) {
      link.textContent = 'Blog';
    }
  });
  
  // æ›´æ–°é¡µé¢å†…å®¹
  updatePageContent('en');
}

function updatePageContent(lang) {
  // æ ¹æ®å½“å‰é¡µé¢å’Œè¯­è¨€æ›´æ–°å†…å®¹
  const currentPath = window.location.pathname;
  
  if (currentPath === '/' || currentPath.includes('about')) {
    updateAboutPage(lang);
  } else if (currentPath.includes('publications')) {
    updatePublicationsPage(lang);
  } else if (currentPath.includes('cv')) {
    updateCVPage(lang);
  } else if (currentPath.includes('blog')) {
    updateBlogPage(lang);
  }
}

function updateAboutPage(lang) {
  if (lang === 'zh') {
    // ä¸­æ–‡ç‰ˆæœ¬å†…å®¹
    const chineseContent = {
      subtitle: 'è®¡ç®—æœºç§‘å­¦ä¸äººå·¥æ™ºèƒ½ç ”ç©¶è€…',
      intro: 'æ¬¢è¿æ¥åˆ°æˆ‘çš„å­¦æœ¯ä¸»é¡µï¼æˆ‘æ˜¯åˆ˜è‰ºè½©ï¼Œç›®å‰ä¸“æ³¨äºè®¡ç®—æœºç§‘å­¦ä¸äººå·¥æ™ºèƒ½é¢†åŸŸçš„ç ”ç©¶ã€‚',
      research_interests: 'ç ”ç©¶å…´è¶£',
      education: 'æ•™è‚²èƒŒæ™¯',
      contact: 'è”ç³»æ–¹å¼'
    };
    
    // æ›´æ–°é¡µé¢å…ƒç´ 
    const subtitle = document.querySelector('.subtitle, .description');
    if (subtitle) subtitle.textContent = chineseContent.subtitle;
    
  } else {
    // è‹±æ–‡ç‰ˆæœ¬å†…å®¹
    const englishContent = {
      subtitle: 'Computer Science & AI Researcher',
      intro: 'Welcome to my academic homepage! I am Yixuan Liu, currently focusing on research in computer science and artificial intelligence.',
      research_interests: 'Research Interests',
      education: 'Education',
      contact: 'Contact'
    };
    
    // æ›´æ–°é¡µé¢å…ƒç´ 
    const subtitle = document.querySelector('.subtitle, .description');
    if (subtitle) subtitle.textContent = englishContent.subtitle;
  }
}

function updatePublicationsPage(lang) {
  // æ›´æ–°ç ”ç©¶ä¸å‘è¡¨é¡µé¢å†…å®¹
  if (lang === 'zh') {
    document.querySelector('h1, .page-title')?.textContent = 'ç ”ç©¶ä¸å‘è¡¨';
  } else {
    document.querySelector('h1, .page-title')?.textContent = 'Research & Publications';
  }
}

function updateCVPage(lang) {
  // æ›´æ–°ç®€å†é¡µé¢å†…å®¹
  if (lang === 'zh') {
    document.querySelector('h1, .page-title')?.textContent = 'ç®€å†';
  } else {
    document.querySelector('h1, .page-title')?.textContent = 'Curriculum Vitae';
  }
}

function updateBlogPage(lang) {
  // æ›´æ–°åšå®¢é¡µé¢å†…å®¹
  if (lang === 'zh') {
    document.querySelector('h1, .page-title')?.textContent = 'åšå®¢';
  } else {
    document.querySelector('h1, .page-title')?.textContent = 'Blog';
  }
}

// é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ä¿å­˜çš„è¯­è¨€åå¥½
document.addEventListener('DOMContentLoaded', function() {
  const savedLang = localStorage.getItem('preferred_language') || 'zh';
  if (savedLang === 'en') {
    switchToEnglish();
  } else {
    switchToChinese();
  }
});
</script>

<style>
.language-switcher {
  margin-left: 10px;
}

.language-switcher .btn {
  border: 1px solid var(--global-divider-color);
  background: var(--global-bg-color);
  color: var(--global-text-color);
  font-size: 0.875rem;
  padding: 0.25rem 0.5rem;
}

.language-switcher .btn:hover {
  background: var(--global-hover-color);
  color: var(--global-hover-text-color);
}

.language-switcher .dropdown-menu {
  min-width: 120px;
  border: 1px solid var(--global-divider-color);
  background: var(--global-bg-color);
}

.language-switcher .dropdown-item {
  color: var(--global-text-color);
  font-size: 0.875rem;
  padding: 0.5rem 1rem;
}

.language-switcher .dropdown-item:hover {
  background: var(--global-hover-color);
  color: var(--global-hover-text-color);
}

.language-switcher .dropdown-item.active {
  background: var(--global-theme-color);
  color: white;
}
</style>
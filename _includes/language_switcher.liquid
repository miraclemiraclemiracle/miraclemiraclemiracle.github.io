<!-- 语言切换器 -->
<div class="language-switcher">
  {% assign current_lang = site.lang | default: 'zh' %}
  
  <div class="dropdown">
    <button class="btn btn-sm dropdown-toggle" type="button" id="languageDropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      <span id="current-lang-display">
        {% if current_lang == 'zh' %}
          🇨🇳 中文
        {% else %}
          🇺🇸 English
        {% endif %}
      </span>
    </button>
    <div class="dropdown-menu dropdown-menu-end" aria-labelledby="languageDropdown">
      <a class="dropdown-item" href="#" onclick="switchLanguage('zh'); return false;">
        🇨🇳 中文
      </a>
      <a class="dropdown-item" href="#" onclick="switchLanguage('en'); return false;">
        🇺🇸 English
      </a>
    </div>
  </div>
</div>

<script>
function switchLanguage(lang) {
  // 保存语言选择到localStorage
  localStorage.setItem('preferred_language', lang);
  
  // 更新语言切换按钮显示
  const langDisplay = document.getElementById('current-lang-display');
  if (langDisplay) {
    if (lang === 'zh') {
      langDisplay.innerHTML = '🇨🇳 中文';
    } else {
      langDisplay.innerHTML = '🇺🇸 English';
    }
  }
  
  // 根据语言切换页面内容
  if (lang === 'en') {
    // 切换到英文版本
    switchToEnglish();
  } else {
    // 切换到中文版本
    switchToChinese();
  }
}

function switchToChinese() {
  // 更新页面标题和导航
  document.title = '刘艺轩的学术主页';
  
  // 更新导航栏
  const navItems = {
    'about': '关于我',
    'publications': '研究与发表',
    'cv': '简历',
    'blog': '博客'
  };
  
  // 更新导航链接文本
  document.querySelectorAll('.nav-link').forEach(link => {
    const href = link.getAttribute('href');
    if (href === '/' || href.includes('about')) {
      link.textContent = '关于我';
    } else if (href.includes('publications')) {
      link.textContent = '研究与发表';
    } else if (href.includes('cv')) {
      link.textContent = '简历';
    } else if (href.includes('blog')) {
      link.textContent = '博客';
    }
  });
  
  // 更新页面内容
  updatePageContent('zh');
}

function switchToEnglish() {
  // 更新页面标题和导航
  document.title = 'Yixuan Liu\'s Academic Homepage';
  
  // 更新导航链接文本
  document.querySelectorAll('.nav-link').forEach(link => {
    const href = link.getAttribute('href');
    if (href === '/' || href.includes('about')) {
      link.textContent = 'About';
    } else if (href.includes('publications')) {
      link.textContent = 'Research & Publications';
    } else if (href.includes('cv')) {
      link.textContent = 'CV';
    } else if (href.includes('blog')) {
      link.textContent = 'Blog';
    }
  });
  
  // 更新页面内容
  updatePageContent('en');
}

function updatePageContent(lang) {
  // 根据当前页面和语言更新内容
  const currentPath = window.location.pathname;
  
  if (currentPath === '/' || currentPath.includes('about')) {
    updateAboutPage(lang);
  } else if (currentPath.includes('publications')) {
    updatePublicationsPage(lang);
  } else if (currentPath.includes('cv')) {
    updateCVPage(lang);
  } else if (currentPath.includes('blog')) {
    updateBlogPage(lang);
  }
}

function updateAboutPage(lang) {
  if (lang === 'zh') {
    // 中文版本内容
    const chineseContent = {
      subtitle: '计算机科学与人工智能研究者',
      intro: '欢迎来到我的学术主页！我是刘艺轩，目前专注于计算机科学与人工智能领域的研究。',
      research_interests: '研究兴趣',
      education: '教育背景',
      contact: '联系方式'
    };
    
    // 更新页面元素
    const subtitle = document.querySelector('.subtitle, .description');
    if (subtitle) subtitle.textContent = chineseContent.subtitle;
    
    // 更新页面标题
    const pageTitle = document.querySelector('h1, .page-title');
    if (pageTitle) pageTitle.textContent = '关于我';
    
    // 更新其他内容
    const sections = document.querySelectorAll('h2, h3');
    sections.forEach(section => {
      const text = section.textContent.trim();
      if (text.includes('Research') || text.includes('研究')) {
        section.textContent = '研究兴趣';
      } else if (text.includes('Education') || text.includes('教育')) {
        section.textContent = '教育背景';
      } else if (text.includes('Contact') || text.includes('联系')) {
        section.textContent = '联系方式';
      }
    });
    
  } else {
    // 英文版本内容
    const englishContent = {
      subtitle: 'Computer Science & AI Researcher',
      intro: 'Welcome to my academic homepage! I am Yixuan Liu, currently focusing on research in computer science and artificial intelligence.',
      research_interests: 'Research Interests',
      education: 'Education',
      contact: 'Contact'
    };
    
    // 更新页面元素
    const subtitle = document.querySelector('.subtitle, .description');
    if (subtitle) subtitle.textContent = englishContent.subtitle;
    
    // 更新页面标题
    const pageTitle = document.querySelector('h1, .page-title');
    if (pageTitle) pageTitle.textContent = 'About Me';
    
    // 更新其他内容
    const sections = document.querySelectorAll('h2, h3');
    sections.forEach(section => {
      const text = section.textContent.trim();
      if (text.includes('Research') || text.includes('研究')) {
        section.textContent = 'Research Interests';
      } else if (text.includes('Education') || text.includes('教育')) {
        section.textContent = 'Education';
      } else if (text.includes('Contact') || text.includes('联系')) {
        section.textContent = 'Contact';
      }
    });
  }
}

function updatePublicationsPage(lang) {
  // 更新研究与发表页面内容
  if (lang === 'zh') {
    document.querySelector('h1, .page-title')?.textContent = '研究与发表';
    
    // 更新页面各部分标题
    const sections = document.querySelectorAll('h2');
    sections.forEach(section => {
      const text = section.textContent.trim();
      if (text.includes('Research') || text.includes('研究')) {
        section.textContent = '研究项目';
      } else if (text.includes('Publications') || text.includes('学术')) {
        section.textContent = '学术论文';
      } else if (text.includes('Google Scholar') || text.includes('谷歌学术')) {
        section.textContent = '谷歌学术';
      }
    });
    
  } else {
    document.querySelector('h1, .page-title')?.textContent = 'Research & Publications';
    
    // 更新页面各部分标题
    const sections = document.querySelectorAll('h2');
    sections.forEach(section => {
      const text = section.textContent.trim();
      if (text.includes('研究') || text.includes('Research')) {
        section.textContent = 'Research Projects';
      } else if (text.includes('学术') || text.includes('Publications')) {
        section.textContent = 'Academic Publications';
      } else if (text.includes('谷歌学术') || text.includes('Google Scholar')) {
        section.textContent = 'Google Scholar';
      }
    });
  }
}

function updateCVPage(lang) {
  // 更新简历页面内容
  if (lang === 'zh') {
    document.querySelector('h1, .page-title')?.textContent = '简历';
    
    // 更新简历各部分标题
    const sections = document.querySelectorAll('h3.card-title');
    sections.forEach(section => {
      const text = section.textContent.trim().toLowerCase();
      if (text.includes('basics') || text.includes('基本信息')) {
        section.textContent = '基本信息';
      } else if (text.includes('education') || text.includes('教育背景')) {
        section.textContent = '教育背景';
      } else if (text.includes('work') || text.includes('工作经历')) {
        section.textContent = '工作经历';
      } else if (text.includes('skills') || text.includes('技能')) {
        section.textContent = '专业技能';
      } else if (text.includes('publications') || text.includes('发表论文')) {
        section.textContent = '发表论文';
      } else if (text.includes('projects') || text.includes('项目经历')) {
        section.textContent = '项目经历';
      } else if (text.includes('awards') || text.includes('获奖情况')) {
        section.textContent = '获奖情况';
      } else if (text.includes('languages') || text.includes('语言能力')) {
        section.textContent = '语言能力';
      } else if (text.includes('interests') || text.includes('兴趣爱好')) {
        section.textContent = '兴趣爱好';
      } else if (text.includes('references') || text.includes('推荐人')) {
        section.textContent = '推荐人';
      }
    });
    
  } else {
    document.querySelector('h1, .page-title')?.textContent = 'Curriculum Vitae';
    
    // 更新简历各部分标题
    const sections = document.querySelectorAll('h3.card-title');
    sections.forEach(section => {
      const text = section.textContent.trim();
      if (text.includes('基本信息') || text.includes('basics')) {
        section.textContent = 'Basics';
      } else if (text.includes('教育背景') || text.includes('education')) {
        section.textContent = 'Education';
      } else if (text.includes('工作经历') || text.includes('work')) {
        section.textContent = 'Work Experience';
      } else if (text.includes('专业技能') || text.includes('skills')) {
        section.textContent = 'Skills';
      } else if (text.includes('发表论文') || text.includes('publications')) {
        section.textContent = 'Publications';
      } else if (text.includes('项目经历') || text.includes('projects')) {
        section.textContent = 'Projects';
      } else if (text.includes('获奖情况') || text.includes('awards')) {
        section.textContent = 'Awards';
      } else if (text.includes('语言能力') || text.includes('languages')) {
        section.textContent = 'Languages';
      } else if (text.includes('兴趣爱好') || text.includes('interests')) {
        section.textContent = 'Interests';
      } else if (text.includes('推荐人') || text.includes('references')) {
        section.textContent = 'References';
      }
    });
  }
}

function updateBlogPage(lang) {
  // 更新博客页面内容
  if (lang === 'zh') {
    document.querySelector('h1, .page-title')?.textContent = '博客';
  } else {
    document.querySelector('h1, .page-title')?.textContent = 'Blog';
  }
}

// 页面加载时检查保存的语言偏好
document.addEventListener('DOMContentLoaded', function() {
  const savedLang = localStorage.getItem('preferred_language') || 'zh';
  if (savedLang === 'en') {
    switchToEnglish();
  } else {
    switchToChinese();
  }
});
</script>

<style>
.language-switcher {
  margin-left: 10px;
}

.language-switcher .btn {
  border: 1px solid var(--global-divider-color);
  background: var(--global-bg-color);
  color: var(--global-text-color);
  font-size: 0.875rem;
  padding: 0.25rem 0.5rem;
}

.language-switcher .btn:hover {
  background: var(--global-hover-color);
  color: var(--global-hover-text-color);
}

.language-switcher .dropdown-menu {
  min-width: 120px;
  border: 1px solid var(--global-divider-color);
  background: var(--global-bg-color);
}

.language-switcher .dropdown-item {
  color: var(--global-text-color);
  font-size: 0.875rem;
  padding: 0.5rem 1rem;
}

.language-switcher .dropdown-item:hover {
  background: var(--global-hover-color);
  color: var(--global-hover-text-color);
}

.language-switcher .dropdown-item.active {
  background: var(--global-theme-color);
  color: white;
}
</style>
<!-- è¯­è¨€åˆ‡æ¢å™¨ -->
<div class="language-switcher">
  {% assign current_lang = site.lang | default: 'zh' %}
  
  <div class="dropdown">
    <button class="btn btn-sm dropdown-toggle" type="button" id="languageDropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      <span id="current-lang-display">
        {% if current_lang == 'zh' %}
          ğŸ‡¨ğŸ‡³ ä¸­æ–‡
        {% else %}
          ğŸ‡ºğŸ‡¸ English
        {% endif %}
      </span>
    </button>
    <div class="dropdown-menu dropdown-menu-end" aria-labelledby="languageDropdown">
      <a class="dropdown-item" href="#" onclick="switchLanguage('zh'); return false;">
        ğŸ‡¨ğŸ‡³ ä¸­æ–‡
      </a>
      <a class="dropdown-item" href="#" onclick="switchLanguage('en'); return false;">
        ğŸ‡ºğŸ‡¸ English
      </a>
    </div>
  </div>
</div>

<script>
function switchLanguage(lang) {
  // ä¿å­˜è¯­è¨€é€‰æ‹©åˆ°localStorage
  localStorage.setItem('preferred_language', lang);
  
  // æ›´æ–°è¯­è¨€åˆ‡æ¢æŒ‰é’®æ˜¾ç¤º
  const langDisplay = document.getElementById('current-lang-display');
  if (langDisplay) {
    if (lang === 'zh') {
      langDisplay.innerHTML = 'ğŸ‡¨ğŸ‡³ ä¸­æ–‡';
    } else {
      langDisplay.innerHTML = 'ğŸ‡ºğŸ‡¸ English';
    }
  }
  
  // æ ¹æ®è¯­è¨€åˆ‡æ¢é¡µé¢å†…å®¹
  if (lang === 'en') {
    // åˆ‡æ¢åˆ°è‹±æ–‡ç‰ˆæœ¬
    switchToEnglish();
  } else {
    // åˆ‡æ¢åˆ°ä¸­æ–‡ç‰ˆæœ¬
    switchToChinese();
  }
}

function switchToChinese() {
  // æ›´æ–°é¡µé¢æ ‡é¢˜å’Œå¯¼èˆª
  document.title = 'åˆ˜è‰ºè½©çš„å­¦æœ¯ä¸»é¡µ';
  
  // æ›´æ–°å¯¼èˆªæ 
  const navItems = {
    'about': 'å…³äºæˆ‘',
    'publications': 'ç ”ç©¶ä¸å‘è¡¨',
    'cv': 'ç®€å†',
    'blog': 'åšå®¢'
  };
  
  // æ›´æ–°å¯¼èˆªé“¾æ¥æ–‡æœ¬
  document.querySelectorAll('.nav-link').forEach(link => {
    const href = link.getAttribute('href');
    if (href === '/' || href.includes('about')) {
      link.textContent = 'å…³äºæˆ‘';
    } else if (href.includes('publications')) {
      link.textContent = 'ç ”ç©¶ä¸å‘è¡¨';
    } else if (href.includes('cv')) {
      link.textContent = 'ç®€å†';
    } else if (href.includes('blog')) {
      link.textContent = 'åšå®¢';
    }
  });
  
  // æ›´æ–°é¡µé¢å†…å®¹
  updatePageContent('zh');
}

function switchToEnglish() {
  // æ›´æ–°é¡µé¢æ ‡é¢˜å’Œå¯¼èˆª
  document.title = 'Yixuan Liu\'s Academic Homepage';
  
  // æ›´æ–°å¯¼èˆªé“¾æ¥æ–‡æœ¬
  document.querySelectorAll('.nav-link').forEach(link => {
    const href = link.getAttribute('href');
    if (href === '/' || href.includes('about')) {
      link.textContent = 'About';
    } else if (href.includes('publications')) {
      link.textContent = 'Research & Publications';
    } else if (href.includes('cv')) {
      link.textContent = 'CV';
    } else if (href.includes('blog')) {
      link.textContent = 'Blog';
    }
  });
  
  // æ›´æ–°é¡µé¢å†…å®¹
  updatePageContent('en');
}

function updatePageContent(lang) {
  // æ ¹æ®å½“å‰é¡µé¢å’Œè¯­è¨€æ›´æ–°å†…å®¹
  const currentPath = window.location.pathname;
  
  if (currentPath === '/' || currentPath.includes('about')) {
    updateAboutPage(lang);
  } else if (currentPath.includes('publications')) {
    updatePublicationsPage(lang);
  } else if (currentPath.includes('cv')) {
    updateCVPage(lang);
  } else if (currentPath.includes('blog')) {
    updateBlogPage(lang);
  }
}

function updateAboutPage(lang) {
  if (lang === 'zh') {
    // ä¸­æ–‡ç‰ˆæœ¬å†…å®¹
    const chineseContent = {
      subtitle: 'è®¡ç®—æœºç§‘å­¦ä¸äººå·¥æ™ºèƒ½ç ”ç©¶è€…',
      intro: 'æ¬¢è¿æ¥åˆ°æˆ‘çš„å­¦æœ¯ä¸»é¡µï¼æˆ‘æ˜¯åˆ˜è‰ºè½©ï¼Œç›®å‰ä¸“æ³¨äºè®¡ç®—æœºç§‘å­¦ä¸äººå·¥æ™ºèƒ½é¢†åŸŸçš„ç ”ç©¶ã€‚',
      research_interests: 'ç ”ç©¶å…´è¶£',
      education: 'æ•™è‚²èƒŒæ™¯',
      contact: 'è”ç³»æ–¹å¼'
    };
    
    // æ›´æ–°é¡µé¢å…ƒç´ 
    const subtitle = document.querySelector('.subtitle, .description');
    if (subtitle) subtitle.textContent = chineseContent.subtitle;
    
    // æ›´æ–°é¡µé¢æ ‡é¢˜
    const pageTitle = document.querySelector('h1, .page-title');
    if (pageTitle) pageTitle.textContent = 'å…³äºæˆ‘';
    
    // æ›´æ–°å…¶ä»–å†…å®¹
    const sections = document.querySelectorAll('h2, h3');
    sections.forEach(section => {
      const text = section.textContent.trim();
      if (text.includes('Research') || text.includes('ç ”ç©¶')) {
        section.textContent = 'ç ”ç©¶å…´è¶£';
      } else if (text.includes('Education') || text.includes('æ•™è‚²')) {
        section.textContent = 'æ•™è‚²èƒŒæ™¯';
      } else if (text.includes('Contact') || text.includes('è”ç³»')) {
        section.textContent = 'è”ç³»æ–¹å¼';
      }
    });
    
  } else {
    // è‹±æ–‡ç‰ˆæœ¬å†…å®¹
    const englishContent = {
      subtitle: 'Computer Science & AI Researcher',
      intro: 'Welcome to my academic homepage! I am Yixuan Liu, currently focusing on research in computer science and artificial intelligence.',
      research_interests: 'Research Interests',
      education: 'Education',
      contact: 'Contact'
    };
    
    // æ›´æ–°é¡µé¢å…ƒç´ 
    const subtitle = document.querySelector('.subtitle, .description');
    if (subtitle) subtitle.textContent = englishContent.subtitle;
    
    // æ›´æ–°é¡µé¢æ ‡é¢˜
    const pageTitle = document.querySelector('h1, .page-title');
    if (pageTitle) pageTitle.textContent = 'About Me';
    
    // æ›´æ–°å…¶ä»–å†…å®¹
    const sections = document.querySelectorAll('h2, h3');
    sections.forEach(section => {
      const text = section.textContent.trim();
      if (text.includes('Research') || text.includes('ç ”ç©¶')) {
        section.textContent = 'Research Interests';
      } else if (text.includes('Education') || text.includes('æ•™è‚²')) {
        section.textContent = 'Education';
      } else if (text.includes('Contact') || text.includes('è”ç³»')) {
        section.textContent = 'Contact';
      }
    });
  }
}

function updatePublicationsPage(lang) {
  // æ›´æ–°ç ”ç©¶ä¸å‘è¡¨é¡µé¢å†…å®¹
  if (lang === 'zh') {
    document.querySelector('h1, .page-title')?.textContent = 'ç ”ç©¶ä¸å‘è¡¨';
    
    // æ›´æ–°é¡µé¢å„éƒ¨åˆ†æ ‡é¢˜
    const sections = document.querySelectorAll('h2');
    sections.forEach(section => {
      const text = section.textContent.trim();
      if (text.includes('Research') || text.includes('ç ”ç©¶')) {
        section.textContent = 'ç ”ç©¶é¡¹ç›®';
      } else if (text.includes('Publications') || text.includes('å­¦æœ¯')) {
        section.textContent = 'å­¦æœ¯è®ºæ–‡';
      } else if (text.includes('Google Scholar') || text.includes('è°·æ­Œå­¦æœ¯')) {
        section.textContent = 'è°·æ­Œå­¦æœ¯';
      }
    });
    
  } else {
    document.querySelector('h1, .page-title')?.textContent = 'Research & Publications';
    
    // æ›´æ–°é¡µé¢å„éƒ¨åˆ†æ ‡é¢˜
    const sections = document.querySelectorAll('h2');
    sections.forEach(section => {
      const text = section.textContent.trim();
      if (text.includes('ç ”ç©¶') || text.includes('Research')) {
        section.textContent = 'Research Projects';
      } else if (text.includes('å­¦æœ¯') || text.includes('Publications')) {
        section.textContent = 'Academic Publications';
      } else if (text.includes('è°·æ­Œå­¦æœ¯') || text.includes('Google Scholar')) {
        section.textContent = 'Google Scholar';
      }
    });
  }
}

function updateCVPage(lang) {
  // æ›´æ–°ç®€å†é¡µé¢å†…å®¹
  if (lang === 'zh') {
    document.querySelector('h1, .page-title')?.textContent = 'ç®€å†';
    
    // æ›´æ–°ç®€å†å„éƒ¨åˆ†æ ‡é¢˜
    const sections = document.querySelectorAll('h3.card-title');
    sections.forEach(section => {
      const text = section.textContent.trim().toLowerCase();
      if (text.includes('basics') || text.includes('åŸºæœ¬ä¿¡æ¯')) {
        section.textContent = 'åŸºæœ¬ä¿¡æ¯';
      } else if (text.includes('education') || text.includes('æ•™è‚²èƒŒæ™¯')) {
        section.textContent = 'æ•™è‚²èƒŒæ™¯';
      } else if (text.includes('work') || text.includes('å·¥ä½œç»å†')) {
        section.textContent = 'å·¥ä½œç»å†';
      } else if (text.includes('skills') || text.includes('æŠ€èƒ½')) {
        section.textContent = 'ä¸“ä¸šæŠ€èƒ½';
      } else if (text.includes('publications') || text.includes('å‘è¡¨è®ºæ–‡')) {
        section.textContent = 'å‘è¡¨è®ºæ–‡';
      } else if (text.includes('projects') || text.includes('é¡¹ç›®ç»å†')) {
        section.textContent = 'é¡¹ç›®ç»å†';
      } else if (text.includes('awards') || text.includes('è·å¥–æƒ…å†µ')) {
        section.textContent = 'è·å¥–æƒ…å†µ';
      } else if (text.includes('languages') || text.includes('è¯­è¨€èƒ½åŠ›')) {
        section.textContent = 'è¯­è¨€èƒ½åŠ›';
      } else if (text.includes('interests') || text.includes('å…´è¶£çˆ±å¥½')) {
        section.textContent = 'å…´è¶£çˆ±å¥½';
      } else if (text.includes('references') || text.includes('æ¨èäºº')) {
        section.textContent = 'æ¨èäºº';
      }
    });
    
  } else {
    document.querySelector('h1, .page-title')?.textContent = 'Curriculum Vitae';
    
    // æ›´æ–°ç®€å†å„éƒ¨åˆ†æ ‡é¢˜
    const sections = document.querySelectorAll('h3.card-title');
    sections.forEach(section => {
      const text = section.textContent.trim();
      if (text.includes('åŸºæœ¬ä¿¡æ¯') || text.includes('basics')) {
        section.textContent = 'Basics';
      } else if (text.includes('æ•™è‚²èƒŒæ™¯') || text.includes('education')) {
        section.textContent = 'Education';
      } else if (text.includes('å·¥ä½œç»å†') || text.includes('work')) {
        section.textContent = 'Work Experience';
      } else if (text.includes('ä¸“ä¸šæŠ€èƒ½') || text.includes('skills')) {
        section.textContent = 'Skills';
      } else if (text.includes('å‘è¡¨è®ºæ–‡') || text.includes('publications')) {
        section.textContent = 'Publications';
      } else if (text.includes('é¡¹ç›®ç»å†') || text.includes('projects')) {
        section.textContent = 'Projects';
      } else if (text.includes('è·å¥–æƒ…å†µ') || text.includes('awards')) {
        section.textContent = 'Awards';
      } else if (text.includes('è¯­è¨€èƒ½åŠ›') || text.includes('languages')) {
        section.textContent = 'Languages';
      } else if (text.includes('å…´è¶£çˆ±å¥½') || text.includes('interests')) {
        section.textContent = 'Interests';
      } else if (text.includes('æ¨èäºº') || text.includes('references')) {
        section.textContent = 'References';
      }
    });
  }
}

function updateBlogPage(lang) {
  // æ›´æ–°åšå®¢é¡µé¢å†…å®¹
  if (lang === 'zh') {
    document.querySelector('h1, .page-title')?.textContent = 'åšå®¢';
  } else {
    document.querySelector('h1, .page-title')?.textContent = 'Blog';
  }
}

// é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ä¿å­˜çš„è¯­è¨€åå¥½
document.addEventListener('DOMContentLoaded', function() {
  const savedLang = localStorage.getItem('preferred_language') || 'zh';
  if (savedLang === 'en') {
    switchToEnglish();
  } else {
    switchToChinese();
  }
});
</script>

<style>
.language-switcher {
  margin-left: 10px;
}

.language-switcher .btn {
  border: 1px solid var(--global-divider-color);
  background: var(--global-bg-color);
  color: var(--global-text-color);
  font-size: 0.875rem;
  padding: 0.25rem 0.5rem;
}

.language-switcher .btn:hover {
  background: var(--global-hover-color);
  color: var(--global-hover-text-color);
}

.language-switcher .dropdown-menu {
  min-width: 120px;
  border: 1px solid var(--global-divider-color);
  background: var(--global-bg-color);
}

.language-switcher .dropdown-item {
  color: var(--global-text-color);
  font-size: 0.875rem;
  padding: 0.5rem 1rem;
}

.language-switcher .dropdown-item:hover {
  background: var(--global-hover-color);
  color: var(--global-hover-text-color);
}

.language-switcher .dropdown-item.active {
  background: var(--global-theme-color);
  color: white;
}
</style>